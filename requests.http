### ============================================
### CONFIGURATION
### ============================================
### Base URL
@baseUrl = http://localhost:3000/api

### JWT Token - Replace with your actual token after Google OAuth login
### Get token from: GET {{baseUrl}}/auth/google/login
### After redirect, copy the access_token from the response
@token = ...

### ============================================
### AUTHENTICATION
### ============================================

### STEP 1: Start OAuth Login (Open this URL in your browser)
### This will redirect you to Google for authentication
### After authentication, you'll be redirected back with a JWT token
GET {{baseUrl}}/auth/google/login

### STEP 2: After Google authentication, you'll be redirected to:
### {{baseUrl}}/auth/google/redirect
### The response will contain your access_token. Copy it and update @token above!

### ============================================
### USERS
### ============================================

### GET all users (ADMIN only)
GET {{baseUrl}}/users
Authorization: Bearer {{token}}

### GET users by role
GET {{baseUrl}}/users?role=USER
Authorization: Bearer {{token}}

### GET user by id
GET {{baseUrl}}/users/1
Authorization: Bearer {{token}}

### POST create user (ADMIN only)
POST {{baseUrl}}/users
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Harry Potter",
  "email": "harrypotter4@gmail.com",
  "role": "ADMIN"
}

### PATCH update user
PATCH {{baseUrl}}/users/1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "email": "harrypotter3@gmail.com"
}

### DELETE user by id (ADMIN only)
DELETE {{baseUrl}}/users/2
Authorization: Bearer {{token}}

### PATCH change user role (ADMIN only)
PATCH {{baseUrl}}/users/2/role
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "role": "ADMIN"
}

### ============================================
### GENRES
### ============================================

### GET all genres
GET {{baseUrl}}/genres
Authorization: Bearer {{token}}

### GET genre by id
GET {{baseUrl}}/genres/1
Authorization: Bearer {{token}}

### POST create genre
POST {{baseUrl}}/genres
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Art"
}

### PATCH update genre (ADMIN only)
PATCH {{baseUrl}}/genres/4
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Fantasy"
}

### DELETE genre by id (ADMIN only)
DELETE {{baseUrl}}/genres/3
Authorization: Bearer {{token}}

### ============================================
### AUTHORS
### ============================================

### GET all authors
GET {{baseUrl}}/authors
Authorization: Bearer {{token}}

### GET author by id
GET {{baseUrl}}/authors/1
Authorization: Bearer {{token}}

### POST create author
POST {{baseUrl}}/authors
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Stephen King"
}

### PATCH update author (ADMIN only)
PATCH {{baseUrl}}/authors/1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Artur Conan Doyle"
}

### DELETE author by id (ADMIN only)
DELETE {{baseUrl}}/authors/1
Authorization: Bearer {{token}}

### ============================================
### BOOKS
### ============================================

### GET all books
GET {{baseUrl}}/books
Authorization: Bearer {{token}}

### GET all books with search
GET {{baseUrl}}/books?q=harry
Authorization: Bearer {{token}}

### GET book by id
GET {{baseUrl}}/books/1
Authorization: Bearer {{token}}

### POST create book
POST {{baseUrl}}/books
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Test Book",
  "isbn": "1234567890",
  "totalPages": 300,
  "authorId": 1,
  "genreId": 1
}

### PATCH update book (ADMIN only)
PATCH {{baseUrl}}/books/1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Updated Book Title"
}

### DELETE book by id (ADMIN only)
DELETE {{baseUrl}}/books/1
Authorization: Bearer {{token}}

### ============================================
### USER-BOOKS - BASIC OPERATIONS
### ============================================

### POST - Create user-book record
POST {{baseUrl}}/user-books
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "userId": 1,
  "bookId": 1,
  "rating": 5,
  "status": "to-read"
}

### GET - Get all user-books (ADMIN only)
GET {{baseUrl}}/user-books
Authorization: Bearer {{token}}

### GET - Get user-book by id
GET {{baseUrl}}/user-books/1
Authorization: Bearer {{token}}

### PATCH - Update user-book
PATCH {{baseUrl}}/user-books/2
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "rating": 4,
  "review": "Great book!"
}

### PATCH - Update user-book status
PATCH {{baseUrl}}/user-books/1/status
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "status": "completed"
}

### PATCH - Update reading progress
PATCH {{baseUrl}}/user-books/1/progress
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "currentPage": 25
}

### DELETE - Delete user-book
DELETE {{baseUrl}}/user-books/2
Authorization: Bearer {{token}}

### ============================================
### USER-BOOKS - FILTERING & SEARCH
### ============================================

### GET - Get all books for a user
GET {{baseUrl}}/user-books/user/1
Authorization: Bearer {{token}}

### GET - Filter by status (to-read)
GET {{baseUrl}}/user-books/user/1?status=to-read
Authorization: Bearer {{token}}

### GET - Filter by status (reading)
GET {{baseUrl}}/user-books/user/1?status=reading
Authorization: Bearer {{token}}

### GET - Filter by status (completed)
GET {{baseUrl}}/user-books/user/1?status=completed
Authorization: Bearer {{token}}

### GET - Filter by author
GET {{baseUrl}}/user-books/user/1?authorId=1
Authorization: Bearer {{token}}

### GET - Filter by genre
GET {{baseUrl}}/user-books/user/2?genreId=1
Authorization: Bearer {{token}}

### GET - Combined filters (status + author)
GET {{baseUrl}}/user-books/user/1?status=to-read&authorId=1
Authorization: Bearer {{token}}

### GET - Combined filters (status + genre + author)
GET {{baseUrl}}/user-books/user/1?status=to-read&authorId=1&genreId=1
Authorization: Bearer {{token}}

### GET - Search user books by title or author
GET {{baseUrl}}/user-books/user/1/search?q=bad
Authorization: Bearer {{token}}

### GET - Get user statistics
GET {{baseUrl}}/user-books/user/1/stats
Authorization: Bearer {{token}}

### GET - Get user statistics for specific year
GET {{baseUrl}}/user-books/user/1/stats?year=2024
Authorization: Bearer {{token}}

### ============================================
### READING GOALS
### ============================================

### POST - Create reading goal
POST {{baseUrl}}/reading-goals
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "userId": 1,
  "goalName": "Read 10 books in summer",
  "targetBooks": 10,
  "startDate": "2025-06-01",
  "endDate": "2025-09-01"
}

### GET - Get all reading goals (ADMIN only)
GET {{baseUrl}}/reading-goals
Authorization: Bearer {{token}}

### GET - Get reading goal by id
GET {{baseUrl}}/reading-goals/1
Authorization: Bearer {{token}}

### GET - Get all reading goals for a user
GET {{baseUrl}}/reading-goals/user/1
Authorization: Bearer {{token}}

### PATCH - Update reading goal
PATCH {{baseUrl}}/reading-goals/1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "targetBooks": 15,
  "isActive": true
}

### DELETE - Delete reading goal
DELETE {{baseUrl}}/reading-goals/1
Authorization: Bearer {{token}}

### ============================================
### NOTES
### ============================================

### GET - Get all notes (ADMIN only)
GET {{baseUrl}}/notes
Authorization: Bearer {{token}}

### POST - Create note
POST {{baseUrl}}/notes
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "content": "I hate main character 2!!!",
  "userBookId": 1,
  "pageNumber": 10
}

### GET - Get note by id
GET {{baseUrl}}/notes/1
Authorization: Bearer {{token}}

### GET - Get notes by user-book
GET {{baseUrl}}/notes/user-book/1
Authorization: Bearer {{token}}

### PATCH - Update note
PATCH {{baseUrl}}/notes/1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "content": "I hate main character!!!",
  "pageNumber": 10
}

### DELETE - Delete note
DELETE {{baseUrl}}/notes/2
Authorization: Bearer {{token}}

### ============================================
### TEST SCENARIOS
### ============================================

### SCENARIO 1: Add new book and start reading
### 1. Add book with "to-read" status
POST {{baseUrl}}/user-books
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "userId": 1,
  "bookId": 2,
  "status": "to-read"
}

### 2. Update progress (automatically changes status to "reading")
PATCH {{baseUrl}}/user-books/1/progress
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "currentPage": 25
}

### 3. Check result
GET {{baseUrl}}/user-books/1
Authorization: Bearer {{token}}

### SCENARIO 2: Complete a book
### 1. Update progress to complete the book (assuming 300 pages)
PATCH {{baseUrl}}/user-books/1/progress
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "currentPage": 300
}

### 2. Add rating
PATCH {{baseUrl}}/user-books/1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "rating": 5
}

### SCENARIO 3: Get books with "reading" status
GET {{baseUrl}}/user-books/user/1?status=reading
Authorization: Bearer {{token}}

### SCENARIO 4: Check statistics
GET {{baseUrl}}/user-books/user/1/stats
Authorization: Bearer {{token}}

### ============================================
### VALIDATION TESTS
### ============================================

### TEST - Invalid status (should return error)
PATCH {{baseUrl}}/user-books/1/status
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "status": "invalid-status"
}

### TEST - Negative page number (should return error)
PATCH {{baseUrl}}/user-books/1/progress
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "currentPage": -10
}

### TEST - Rating out of range (should return error)
PATCH {{baseUrl}}/user-books/1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "rating": 10
}

### TEST - Non-existent user or book
POST {{baseUrl}}/user-books
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "userId": 9999,
  "bookId": 9999,
  "status": "to-read"
}

### TEST - Duplicate record (user already added this book)
POST {{baseUrl}}/user-books
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "userId": 1,
  "bookId": 1,
  "status": "to-read"
}
